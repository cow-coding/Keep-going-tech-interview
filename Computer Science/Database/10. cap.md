# CAP

## CAP 이론

- 분산형 구조가 갖는 3가지 특징을 줄여서 CAP이라 함
- 이 중 CAP이론은 2가지만 만족할 수 있다는 이론으로 NoSQL은 대부분 CAP이론을 따름
  - 보통 분산 허용은 고정하고 나머지 중 하나를 특징으로 가짐
- `C`onsistency (일관성)
- `A`vailability (가용성)
- `P`artitioning Tolerance (분산 허용)
- 시간이 지남에 따라 문제점이 등장했고 이를 보완하고자 PACELC 이론이 등장

> Consistency

- 분산된 노드 중 어느 노드로 접근하더라도 데이터 값이 같아야 함
- 데이터 복제 중에 쿼리가 되는, 일관성을 제공하지 않는 시스템의 경우 다른 데이터 값이 쿼리될 수 있음
- NoSQL은 일관성이 느슨하게 처리되어 동일하지 않을 수 있지만 `시간이 흐름에 따라 여러 노드에 전파되어 최종적으로 일관성이 유지됨`
- 분산 노드 간의 데이터 동기화 방법
  - 동기식 방법 : 데이터 저장 결과를 클라이언트 응답 전에 모든 노드에 전파
  - 비동기식 방법 : 메모리나 임시 파일에 기록하고 클라이언트에 우선 응답 후 노드로 데이터 동기화

> Availability

- 클러스터링된 노드 중 하나 이상의 노드가 실패라도 정상적으로 요청을 처리할 수 있는 기능
- 몇 개의 노드가 망가지더라도 정상적이 서비스가 가능함
- 가용성을 보장하고자 `데이터 복제(Replication)`를 사용
  - Master-Slave 복제 방법 : 동일 데이터를 가진 저장소를 더 생성
  - Peer-to-Peer 복제 : 데이터 단위로 중복 저장
- 동일 데이터를 다중 노드에 중복 저장하여 데이터가 유실되는 것을 방지함

> Partitioning Tolerance

- 클러스터링 노드 간에 통신하는 `네트워크가 장애가 나더라도` 정상적으로 서비스를 수행함
- 노드 간 물리적으로 전혀 다른 네트워크 공간에 위치 가능

## Reference

- [빨간색 코딩 - NoSQL](https://sjh836.tistory.com/97)
- [어제도 그랬어 - NoSQL, CAP 이론과 PACELC 이론](https://osy0907.tistory.com/95)